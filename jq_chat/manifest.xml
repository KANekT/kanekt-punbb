<?xml version="1.0" encoding="utf-8"?>
<!--
/*
 * manifest file for jQuery Chat
 *
 * @copyright Copyright (C) 2009 KANekT @ http://blog.teamrip.ru
 * @license http://www.gnu.org/licenses/gpl.html GPL version 2 or higher
 * @package jQuery Chat
*/
-->

<extension engine="1.0">
	<id>jq_chat</id>
	<title>jQuery Chat</title>
	<version>0.1.0</version>
	<description>Adds a jQuery chat to the forum index.</description>
	<author>KANekT</author>
	<minversion>1.3</minversion>
	<maxtestedon>1.3.4</maxtestedon>

	<dependencies>
		<dependency>jquery</dependency>
	</dependencies>

	<install><![CDATA[
		if (file_exists('../extensions/jq_chat/lang/'.$forum_user['language'].'.php'))
			require '../extensions/jq_chat/lang/'.$forum_user['language'].'.php';
		else
			require '../extensions/jq_chat/lang/English.php';
		$user=$lang_jq_chat['Welcome'];
		
		$schema = array(
				'FIELDS'  => array(
					'id'  => array(
						'datatype'  => 'SERIAL',
						'allow_null'  => false
					),
					'name'  => array(
						'datatype'  => 'char(100)',
						'allow_null'  => false
					),
					'text'  => array(
						'datatype'  => 'text',
						'allow_null'  => false
					)
				),
				'PRIMARY KEY'  => array('id')
			);
		$forum_db->create_table('messages', $schema);
		$query = array(
		   'INSERT'  => 'name, text',
		   'INTO'    => 'messages',
		   'VALUES'  => '\'KANekT\', \''.$user.'\'' 
		);
		$forum_db->query_build($query);

	]]></install>
	<uninstall>
		<![CDATA[
			$forum_db->drop_table('messages');
		]]>
	</uninstall>
	<hooks>
		<hook id="hd_head" priority="10"><![CDATA[

// add javascript and style files on the Index
if(FORUM_PAGE === 'index') {
	$forum_head['jq_chat_js'] = '<script type="text/javascript" src="'.$ext_info['url'].'/chat.js"></script>';

	$jq_chat_css = (file_exists($ext_info['path'].'/'.$forum_user['style'].'.css')) ? $forum_user['style'] : 'default';
	$forum_head['style_jq_chat'] = '<link rel="stylesheet" type="text/css" media="screen" href="'.$ext_info['url'].'/'.$jq_chat_css.'.css" />';
	}

		]]></hook>
		
		<hook id="in_main_output_start"><![CDATA[

		if (file_exists($ext_info['path'].'/lang/'.$forum_user['language'].'.php'))
			require $ext_info['path'].'/lang/'.$forum_user['language'].'.php';
		else
			require $ext_info['path'].'/lang/English.php';

		if ($forum_user['is_guest']) $user=$lang_jq_chat['Guest'];
		else $user=$forum_user['username'];
?>
<div>
	<div class="main-head">
		<h2 class="hn"><span><?php echo $lang_jq_chat['Chat'] ?></span></h2>
	</div>
<!-- Вот в этих 2-х div-ах будут идти наши сообщения из чата -->
<div class="chat r4">
<div id="chat_area"><!-- Сюда мы будем добавлять новые сообщения --></div>
</div>
<form id="pac_form" action=""><!-- Наша форма с именем, сообщением и кнопкой для отправки -->
<table style="width: 100%;">
        <tr>
                <td>Имя:</td>
                <td>Сообщение:</td>
                <td></td>
        </tr>
        <tr>
                <!-- Поле ввода имени -->
                <td><input type="text" id="pac_name" class="r4" value="<?php echo $user ?>" readonly="readonly"></td>
 
                <!-- Поле ввода сообщения -->
                <td style="width: 80%;"><input type="text" id="pac_text" class="r4" value=""></td>
 
                <!-- Кнопка "Отправить" -->
                <td><input type="submit" value="Отправить"></td>
        </tr>
</table>
</form>
 
</div>
<?php

		]]></hook>
	</hooks>
</extension>