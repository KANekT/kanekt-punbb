<?xml version="1.0" encoding="utf-8"?>
<!--
/*
 * manifest file for hide
 *
 * @copyright Copyright (C) 2009 KANekT @ http://blog.teamrip.ru
 * @license http://www.gnu.org/licenses/gpl.html GPL version 2 or higher
 * @package hide
*/
-->
<extension engine="1.0">
	<id>hide</id>
	<title>hide</title>
	<version>0.1.0</version>
	<description>Hide text</description>
	<author>KANekT</author>
	<minversion>1.3</minversion>
	<maxtestedon>1.3.4</maxtestedon>

	<hooks>
        <hook id="ps_preparse_tags_start"><![CDATA[

// add our tag to the list
$tags[] = 'hide';
$tags_opened[] = 'hide';
$tags_closed[] = 'hide';
$tags_quotes[] = 'hide';
$tags_trim[] = 'hide';

        ]]></hook>
	<hook id="ps_parse_message_pre_split"><![CDATA[
		global $forum_url;

		if (file_exists($ext_info['path'].'/lang/'.$forum_user['language'].'.php'))
						require $ext_info['path'].'/lang/'.$forum_user['language'].'.php';
				else
						require $ext_info['path'].'/lang/English.php';
		
		if ($forum_user['is_guest'])
		{
			$text = preg_replace('#\[hide\](.*?)\[\/hide\]#si', '[code]'.sprintf($lang_hide['Hidden text guest'], '<a href="'.forum_link($forum_url['login']).'">'.$lang_hide['login'].'</a>').'[/code]', $text);
		}
		else 
        {
            preg_match('#\[hide=([0-9]*)]#s',$text,$hide_count);
            if(!isset($hide_count[1])) $hide_count[1]=0;
			
            if($forum_user['num_posts'] > $hide_count[1])
            {
                $text = preg_replace('#\[hide](.*?)\[/hide\]#s', '<blockquote>'.$lang_hide['Hidden text'].':<br><i>$1</i></blockquote>', $text);
                $text = preg_replace('#\[hide=([0-9]*)](.*?)\[/hide\]#s', '<blockquote>'.$lang_hide['Hidden text'].':<br><i>$2</i></blockquote>', $text);
            }
            else
            {
                $text = preg_replace("#\[hide=([0-9]*)](.*?)\[/hide\]#s", '<b>['.$lang_hide['Hidden count begin'].' '.$hide_count[1].' '.$lang_hide['Hidden count end'].']</b>', $text);
				
            }

        }
	]]></hook>
	<hook id="he_new_bbcode_text_style"><![CDATA[
		if (file_exists($ext_info['path'].'/lang/'.$forum_user['language'].'.php'))
						require $ext_info['path'].'/lang/'.$forum_user['language'].'.php';
				else
						require $ext_info['path'].'/lang/English.php';
			?><div class="entry-content">
				<code>[hide]<?php echo $lang_hide['Hidden text'] ?>[/hide]</code> <span><?php echo $lang_help['produces'] ?></span>
				<div class="entry-content"><p><blockquote><?php echo $lang_hide['Hidden text'] ?><br><i><?php echo $lang_hide['Hidden text'] ?></i></blockquote></p></div>
			</div><?
			]]></hook>
	</hooks>
</extension>
